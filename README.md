# BankInABox
This is a simple implementation of a Retail Banking application, intended to show features of Hazelcast IMDG and Hazelcast Jet being used cooperatively.

The initial implementation is focused on Fraud Detection.   In IMDG, an Executor-based RuleEngine is used to execute RuleSets; each RuleSet consists of a
set of rules and then an aggregation of the rule results into an overall pass/fail score. 
Two rulesets are currently in place; one for Location based rules and one for Merchant based
rules.  

### One-time setup:

#### MariaDB
When running, the demo operates all in-memory, but the data is originally loaded from a MariaDB database.  You'll need 
to set up MariaDB as a service on the system where the demo will run, and do a one-time generation of test data 
into the database.

The database server needs to be downloaded and started.

For MacOS, this can be done as follows
```bash
brew install mariadb
brew services start mariadb
# if error seen about missing directory
mkdir /usr/local/etc/my.cnf.d
```
Once the database service is running, you can pre-populate the data by running the following script from the
top-level BankInABox directory

```bash
./runPreloader.sh
```

The preloader takes about 3-5 minutes to generate data.  One complete, your system is now set up to run the demo. 

### To run:
First, start at least 3 IMDG Cluster nodes using the script runImdg.sh
```bash
./runImdg.sh
```

Three nodes are required because the demo uses some features of the CP subsystem that requires 3 nodes to operate.

You should also start the Grafana dashboard in order to observe the output generated by the demo.  From the
top-level BankInABox directory
```bash
make up
```

You can then point a browser to `https://localhost:80` and select the BankInABox dashboard after logging in with
the default username and password.

Finally, start the demo itself by running the following script in the top-level BankInABox directory
```$bash
./runLauncher.sh
```

The launcher script runs the main Launcher class in the demo application, which does all of the
following:
* Triggers a preload of the Merchant and Account info from the database into the
data grid
* Sets a listener on the preAuth map to detect incoming transactions.  The listener forwards trasactions 
to each RuleSet Executor by writing the transaction to a ruleset specific Queue. 
* Starts a Jet pipeline to monitor the incoming transaction stream and aggregate the average transaction amount by 
merchant
* Starts executors for each RuleSet (current demo has two)
* Starts an executor to aggregate completed RuleSet results
* Starts a periodic task (5 second interval) that writes data to the Graphite sink
used by the Grafana dashboard to show results. 
* Loads data from the database Transaction table into the preAuth map; this then triggers the 
listener and Jet pipeline to begin processing.

Hazelcast Management Center can be used to monitor the maps and watch how data moves between the maps.   (Generated
transactions go into the preAuth map; once they have been processed they will move to either approved, rejectedForCredit, 
or rejectedForFraud). 

Jet Management Center can be used to monitor the Jet pipeline job.  The pipeline watches the transaction stream and 
calculates updated average transaction amounts per merchant.   The Jet Management Center startup script needs to be 
modified to connect to port 5710 rather than default 5701, so that Jet and IMDG can run on the same server without 
collision.
